<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" ng-app="app" lang="en">
<head>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" href="/static/lib/bootstrap.min.css"/>
    <link rel="stylesheet" href="/static/css/main_a340c41.css"/>
    <link rel="stylesheet" href="/static/lib/bootstrap-datetimepicker.min.css"/>
    <script src="/static/lib/jquery-1.11.1.min.js"></script>
    <script src="/static/lib/bootstrap.min.js"></script>
    <script src="/static/lib/angular.min.js"></script>
    <script type="text/javascript" src="/static/lib/bootstrap-datetimepicker.min.js"></script>
    <script type="text/javascript" src="/static/lib/bootstrap-datetimepicker.zh-CN.js"></script>
    <script src="/static/js/admin/ngPlugin-unCompress.4f7c7e4.js"></script>
    <style>
        .route_date .tbody .trow p {
            position: absolute;
            height: 48px;
            line-height: 48px;
            width: 100%;
            left: 0;
            top: 0;
            cursor: pointer;
        }

        .route_date .tbody .trow p.hover {
            text-indent: -10000px;
            background: url(/static/images/date_hover.png) no-repeat;
        }

        .route_date .tbody .trow p.past {
            cursor: default;
            background: none;
            text-indent: 0;
        }

        .route_date .tbody .trow span {
            cursor: default;
        }

        .sContainer .date .prev, .sContainer .date .next {
            -webkit-user-select: none;
        }

        .route_date .tbody .trow span .detail {
            width: 100%;
            text-align: center;
            position: absolute;
            height: 90px;
            top: 48px;
            left: 0;
        }

        .route_date .tbody .trow span .detail div {
            height: 30px;
            width: 100%;
            color: white;
            line-height: 30px;
        }

        .route_date .tbody .trow span .detail div:nth-child(1) {
            background-color: rgb(68, 157, 99);
        }

        .route_date .tbody .trow span .detail div:nth-child(2) {
            background-color: rgb(156, 110, 159);
        }

        .route_date .tbody .trow span .detail div:nth-child(3) {
            background-color: rgb(131, 139, 47);
        }

        /*background-color: rgb(68, 157, 99);*/
        /*background-color: rgb(156, 110, 159);*/
        /*background-color: rgb(131, 139, 47);*/
    </style>
</head>

<body ng-controller="validate">
<div class="sContainer">
    <div class="date">
        <span ng-click="prev()" class="prev">
            <span></span>
            <span ng-bind="month==1?12:month-1+'月'"></span>
        </span>
        <span><input class="dt readonly" readonly="readonly" type="text" /></span>
        <span ng-click="next()" class="next">
            <span></span><span ng-bind="month==12?1:month+1+'月'"></span>
        </span>
    </div>
</div>
<div class="route_date">
    <div class="thead">
        <span>日</span>
        <span>一</span>
        <span>二</span>
        <span>三</span>
        <span>四</span>
        <span>五</span>
        <span>六</span>
    </div>
    <div class="tbody">
        <div class="trow" ng-repeat="week in calendar track by $index">
            <div class="trow_title" style="cursor:default;height: 138px;">
                <span ng-cloak="" style="position: relative;cursor: pointer;" ng-repeat="day in week track by $index">
                    <p ng-click="edit($event)" ng-mouseenter="hoverIndex = $index" ng-mouseleave="hoverIndex = 100"
                       ng-class="{hover:hoverIndex==$index,past: day=='' || (year+'-'+(month.toString().length==1?'0'+month:month)+'-'+(day.toString().length==1?'0'+day:day))&lt;(currentYear+'-'+(currentMonth.toString().length==1?'0'+currentMonth:currentMonth)+'-'+(currentDay.toString().length==1?'0'+currentDay:currentDay))}"
                       style="text-align: center;font-size: 18px;color:#757575" ng-bind="day"></p>
                    <div class="detail" data-index="{{$index}}"
                         ng-if="stock.day == (year+'-'+(month.toString().length==1?'0'+month:month)+'-'+(day.toString().length==1?'0'+day:day))"
                         ng-repeat="stock in stockArray track by $index">
                        <div ng-bind="'库存:'+stock.availableQuantity"></div>
                        <div ng-bind="'儿童票:'+stock.price"></div>
                        <div ng-bind="'成人票:'+stock.id"></div>
                    </div>
                </span>
            </div>
        </div>
    </div>
</div>
<script th:inline="javascript">
    //    <![CDATA[
    var app = angular.module('app', ['ngPlugin']).controller('validate', ['$scope', '$http', function ($scope, $http) {
        $('.dt').datetimepicker({
            format: 'yyyy.mm',
            language: 'zh-CN',
            maxView: 4,
            minView: 3,
            startView: 3,
            autoclose: true
        }).on('changeMonth', function (ev) {
            var renderObj = calendarRender(ev.date.getFullYear() + '-' + (ev.date.getMonth() + 1));
            $scope.calendar = renderObj.dateArray;
            $scope.month = renderObj.month;
            $scope.year = renderObj.year;
            $scope.start = renderObj.start;
            $scope.end = renderObj.end;
            $scope.$apply();
            stock();
        });

        $scope.postData = {
            productPriceList: [[${productPriceList}]] || ''
        };
        //请求库存
        function stock() {
            $http.post('/url', {start: $scope.start, end: $scope.end}).success(function (data) {
                if (data.code == 0) {

                } else {

                }
            }).error(function () {

            }).then(function () {
                $scope.stockArray = [
                    {availableQuantity: 1, day: '2016-05-01', price: 1, soldQuantity: 1},
                    {availableQuantity: 1, day: '2016-05-02', price: 1, soldQuantity: 1},
                    {availableQuantity: 1, day: '2016-05-03', price: 1, soldQuantity: 1},
                    {availableQuantity: 1, day: '2016-05-04', price: 1, soldQuantity: 1},
                    {availableQuantity: 1, day: '2016-05-05', price: 1, soldQuantity: 1},
                    {availableQuantity: 1, day: '2016-05-06', price: 1, soldQuantity: 1}
                ]
            })
        }

        var currentDate = new Date();
        $scope.currentYear = currentDate.getFullYear();
        $scope.currentMonth = currentDate.getMonth() + 1;
        $scope.currentDay = currentDate.getDate();
        function calendarRender(time) {
            //time格式为'2016-1'如果不存在,则初始化本地时间
            var date;
            if (time) {
                time = time.replace(',', '-');
                var timeArray = time.split('-');
                date = new Date(timeArray[0], timeArray[1] - 1, 1);
            } else {
                date = new Date();
            }
            $('.dt').val((date.getFullYear()) + '.' + (date.getMonth() + 1));
            date.setDate(1);
            var offset = date.getDay();
            date.setMonth(date.getMonth() + 1);
            date.setDate(0);
            var len = date.getDate();
            var array = [];
            for (var i = 0; i < (len + offset); i++) {
                array.push(i < offset ? '' : i - offset + 1);
            }
            var max = Math.ceil(array.length / 7);
            var newArray = [];
            for (var i = 0; i < max; i++) {
                newArray.push(array.splice(0, 7));
            }

            return {
                dateArray: newArray,
                month: date.getMonth() + 1,
                year: date.getFullYear(),
                start: date.getFullYear() + '-' + (date.getMonth() + 1) + 1,
                end: date.getFullYear() + '-' + (date.getMonth() + 1) + len
            };
        }

        var calendarRenderResult = calendarRender();
        $scope.calendar = calendarRenderResult.dateArray;
        $scope.month = calendarRenderResult.month;
        $scope.year = calendarRenderResult.year;
        $scope.start = calendarRenderResult.start;
        $scope.end = calendarRenderResult.end;
        $scope.prev = function () {
            var renderObj;
            if ($scope.month == 1) {
                renderObj = calendarRender(($scope.year - 1) + '-' + 12);
            } else {
                renderObj = calendarRender($scope.year + '-' + ($scope.month - 1));
            }
            $scope.calendar = renderObj.dateArray;
            $scope.month = renderObj.month;
            $scope.year = renderObj.year;
            $scope.start = renderObj.start;
            $scope.end = renderObj.end;
            stock();
        };
        $scope.edit = function (e) {
            if (!angular.element(e.target).hasClass('past')) {
                var index = angular.element(e.target).next('div').attr('data-index');
                if (index) {
                    //存在为编辑
                } else {
                    //不存在为添加
                }
            }
        };
        //存放库存的数组
        $scope.stockArray = [
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-24",
                "id": 90921,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-25",
                "id": 90920,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-26",
                "id": 90919,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-27",
                "id": 90918,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-28",
                "id": 90917,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-29",
                "id": 90916,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-30",
                "id": 90915,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-23",
                "id": 90914,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-22",
                "id": 90913,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-21",
                "id": 90912,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-20",
                "id": 90911,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-19",
                "id": 90910,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-18",
                "id": 90909,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-17",
                "id": 90908,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-16",
                "id": 90907,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 2
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-15",
                "id": 90906,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-14",
                "id": 90905,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-13",
                "id": 90904,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-12",
                "id": 90903,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-11",
                "id": 90902,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-10",
                "id": 90901,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-09",
                "id": 90900,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-08",
                "id": 90899,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-07",
                "id": 90898,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            },
            {
                "availableQuantity": 22,
                "createdTime": "2016-04-21",
                "day": "2016-04-06",
                "id": 90897,
                "inventoryType": "product",
                "inventoryTypeId": 10000466,
                "online": true,
                "price": 0.01,
                "quantity": 22,
                "soldQuantity": 0,
                "version": 0
            }
        ]
        $scope.next = function () {
            var renderObj;
            if ($scope.month == 12) {
                renderObj = calendarRender(($scope.year + 1) + '-' + 1);
            } else {
                renderObj = calendarRender($scope.year + '-' + ($scope.month + 1));
            }
            $scope.calendar = renderObj.dateArray;
            $scope.month = renderObj.month;
            $scope.year = renderObj.year;
            $scope.start = renderObj.start;
            $scope.end = renderObj.end;
            stock();
        }
    }])
    //    ]]>
</script>
</body>
</html>